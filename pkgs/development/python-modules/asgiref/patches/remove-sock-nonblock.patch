Origin: https://github.com/django/asgiref/commit/31541da6e68c1961f00d206b8386aee6df76d8b6.patch
---
 tests/test_server.py | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/tests/test_server.py b/tests/test_server.py
index 8f86096d..616ccf21 100644
--- a/tests/test_server.py
+++ b/tests/test_server.py
@@ -21,7 +21,8 @@ def __init__(self, application, max_applications=1000):
             application,
             max_applications=max_applications,
         )
-        self._sock = sock.socket(sock.AF_INET, sock.SOCK_DGRAM | sock.SOCK_NONBLOCK)
+        self._sock = sock.socket(sock.AF_INET, sock.SOCK_DGRAM)
+        self._sock.setblocking(False)
         self._sock.bind(("127.0.0.1", 0))

     @property
@@ -54,7 +55,8 @@ def close(self):

 class Client:
     def __init__(self, name):
-        self._sock = sock.socket(sock.AF_INET, sock.SOCK_DGRAM | sock.SOCK_NONBLOCK)
+        self._sock = sock.socket(sock.AF_INET, sock.SOCK_DGRAM)
+        self._sock.setblocking(False)
         self.name = name

     async def register(self, server_addr, name=None):
